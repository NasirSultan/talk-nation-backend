generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL") // used for migrations
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String?
  phone     String?
  country   String?
  role      String?  // optional role (USER, ADMIN, etc.)
  file      String?  // optional file path or URL
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  posts     Post[]
  podcasts  Podcast[]
  longvideos  Longvideo[] 
  reels  Reel[]
  blogs     Blog[]
  polls      Poll[]       @relation("UserPolls")     // polls created by this user
  pollVotes  PollVote[]   @relation("UserVotes")     // votes cast by this user
  livestreams  Livestream[] 
  reactions Reaction[] 
  comments  Comment[] 
   shares   Share[] 
     bookmarks Bookmark[]
  
}

model Otp {
  id        Int      @id @default(autoincrement())
  email     String
  code      String
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model Post {
  id        String    @id @default(uuid())
  title     String?   
  text      String
  hashtag   String?
  file      String?
  comment   Boolean?
  view      ViewType  @default(PUBLIC)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  reactions    Reaction[]
  comments  Comment[]
   shares   Share[] 
     bookmarks Bookmark[]
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum ViewType {
  PUBLIC
  PRIVATE
  FOLLOWERS
}



model Podcast {
  id           String        @id @default(uuid())
  title        String
  description  String?
  file         String?
  thumbnail    String?
  websiteUrl   String?
  urlDesc      String?
  session      Int?
  episode      Int?
  categories   String[]
  view         ViewType       @default(PUBLIC)
  comment      Boolean        @default(true)
  reaction     Boolean        @default(true)
  share        Boolean        @default(true)
  thought      Boolean        @default(true)
  scheduledAt  DateTime?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  userId       String
  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  chapters     Chapter[]
  reactions    Reaction[] 
   comments  Comment[]
    shares   Share[] 
      bookmarks Bookmark[]
}

model Chapter {
  id          String   @id @default(uuid())
  title       String
  description String?
  file        String?
  duration    Int?
  podcastId   String? 
  podcast     Podcast? @relation(fields: [podcastId], references: [id], onDelete: Cascade)
longvideoId String?   
  longvideo   Longvideo?  @relation(fields: [longvideoId], references: [id], onDelete: Cascade)
}



enum VideoQuality {
  AUTO
  P1440
  P1080
  P720
  P480
  P360
}

model Longvideo {
  id           String       @id @default(uuid())
  title        String
  description  String?
  file         String?      
  thumbnails   String[]     
  download     Boolean      @default(true)
  categories   String[]
  quality      VideoQuality @default(AUTO)
  view         ViewType     @default(PUBLIC)
  comment      Boolean      @default(true)
  reaction     Boolean      @default(true)
  share        Boolean      @default(true)
  thought      Boolean      @default(true)
  scheduledAt  DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  userId       String
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  chapters     Chapter[]
    reactions    Reaction[]
     comments  Comment[]
      shares   Share[] 
        bookmarks Bookmark[]
  @@index([userId])
  @@index([scheduledAt])
  @@index([createdAt])
  @@index([categories], type: Gin)
}


model Reel {
  id              String      @id @default(uuid())
  title           String
  description     String?
  file            String
  thumbnail       String?
  categories      String[]

  browserSound    Boolean     @default(true)
  view            ViewType    @default(PUBLIC)

  allowDuets      Boolean     @default(true)
  allowRemixes    Boolean     @default(true)
  showInFeed      Boolean     @default(true)

  comment         Boolean     @default(true)
  reaction        Boolean     @default(true)
  share           Boolean     @default(true)
  thought         Boolean     @default(true)

  scheduledAt     DateTime? 
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  reactions    Reaction[]
   comments  Comment[]
    shares   Share[] 
      bookmarks Bookmark[]
  @@index([userId])
  @@index([createdAt])
  @@index([categories], type: Gin)
}


model Blog {
  id             String      @id @default(uuid())
  title          String
  file           String
  excerpt        String?     // short summary of the blog
  content        Json        // structured content: blocks, markdown + metadata
  media          String[]    @default([]) // one or more media files, empty if none


  categories     String[]    // tags or categories

  seoDescription String?     // SEO description
  seoWebbug      String?     // SEO webbug or tracking

  view           ViewType    @default(PUBLIC) // privacy/public

  allowComments  Boolean     @default(true)   // allow comments
  allowReactions Boolean     @default(true)   // likes, reactions
  allowShare     Boolean     @default(true)   // shareable
  featured       Boolean     @default(false)  // mark as featured post

  scheduledAt    DateTime?   // optional schedule for publishing

  hateSpeechFlag Boolean     @default(true)  // flagged for hate speech or inappropriate content

  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  authorId       String
  author         User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
    reactions    Reaction[]
     comments  Comment[]
      shares   Share[] 
        bookmarks Bookmark[]
  @@index([authorId])
  @@index([createdAt])
  @@index([categories], type: Gin)
  @@index([media], type: Gin)
  @@index([scheduledAt])
  @@index([hateSpeechFlag])
}



model Poll {
  id              String        @id @default(uuid())
  question        String
  categories      String[]
  view            ViewType      @default(PUBLIC)

  allowAnonymous  Boolean       @default(true)
  showResults     Boolean       @default(true)
  allowComments   Boolean       @default(true)
  allowReactions  Boolean       @default(true)
  allowShare      Boolean       @default(true)
  sendNotification Boolean      @default(false)
  featured        Boolean       @default(false)

  scheduledAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  authorId        String?
  author          User?         @relation("UserPolls", fields: [authorId], references: [id], onDelete: SetNull)

  options         PollOption[]
    reactions    Reaction[]
     comments  Comment[]
      shares   Share[] 
        bookmarks Bookmark[]
  @@index([authorId])
  @@index([createdAt])
  @@index([categories], type: Gin)
  @@index([scheduledAt])
}

model PollOption {
  id       String       @id @default(uuid())
  text     String
  votes    PollVote[]
  pollId   String?
  poll     Poll?         @relation(fields: [pollId], references: [id], onDelete: SetNull)
}

model PollVote {
  id        String       @id @default(uuid())
  userId    String?
  user      User?         @relation("UserVotes", fields: [userId], references: [id], onDelete: SetNull)
  optionId  String?
  option    PollOption?   @relation(fields: [optionId], references: [id], onDelete: SetNull)
  createdAt DateTime      @default(now())

  @@unique([userId, optionId])
}



model Livestream {
  id             String      @id @default(uuid())
  title          String
  description    String?
  file           String?
  categories     String[]
  liveMode       LiveMode    @default(ROMAN)
  view           ViewType    @default(PUBLIC)

  lobbySettings  LobbySettings?

  allowComments  Boolean     @default(true)
  allowReactions Boolean     @default(true)
  allowShare     Boolean     @default(true)
  featured       Boolean     @default(false)

  scheduledAt    DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  userId         String
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)
    reactions    Reaction[]
     comments  Comment[]
      shares   Share[] 
        bookmarks Bookmark[]
  @@index([userId])
  @@index([scheduledAt])
  @@index([createdAt])
  @@index([categories], type: Gin)
}

enum LiveMode {
  ROMAN
  INTERVIEW
}

model LobbySettings {
  id            String      @id @default(uuid())
  livestreamId  String      @unique
  livestream    Livestream  @relation(fields: [livestreamId], references: [id], onDelete: Cascade)
  
  enablePreShow Boolean     @default(false)
  allowEarlyChat Boolean    @default(false)
  showViewCount Boolean     @default(true)
}



model Reaction {
  id            String        @id @default(uuid())
  type          ReactionType  @default(LIKE)
  userId        String
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  postId        String?
  post          Post?         @relation(fields: [postId], references: [id], onDelete: Cascade)

  podcastId     String?
  podcast       Podcast?      @relation(fields: [podcastId], references: [id], onDelete: Cascade)

  longvideoId   String?
  longvideo     Longvideo?    @relation(fields: [longvideoId], references: [id], onDelete: Cascade)

  reelId        String?
  reel          Reel?         @relation(fields: [reelId], references: [id], onDelete: Cascade)

  blogId        String?
  blog          Blog?         @relation(fields: [blogId], references: [id], onDelete: Cascade)

  pollId        String?
  poll          Poll?         @relation(fields: [pollId], references: [id], onDelete: Cascade)

  livestreamId  String?
  livestream    Livestream?   @relation(fields: [livestreamId], references: [id], onDelete: Cascade)

  createdAt     DateTime      @default(now())

  @@index([userId])
  @@index([postId])
  @@index([podcastId])
  @@index([longvideoId])
  @@index([reelId])
  @@index([blogId])
  @@index([pollId])
  @@index([livestreamId])
}

enum ReactionType {
  LIKE
  LOVE
  CLAP
  FIRE
  LAUGH
  SAD
  ANGRY
}






model Comment {
  id        String    @id @default(uuid())
  text      String
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  postId        String?
  post          Post?         @relation(fields: [postId], references: [id], onDelete: Cascade)

  podcastId     String?
  podcast       Podcast?      @relation(fields: [podcastId], references: [id], onDelete: Cascade)

  longvideoId   String?
  longvideo     Longvideo?    @relation(fields: [longvideoId], references: [id], onDelete: Cascade)

  reelId        String?
  reel          Reel?         @relation(fields: [reelId], references: [id], onDelete: Cascade)

  blogId        String?
  blog          Blog?         @relation(fields: [blogId], references: [id], onDelete: Cascade)

  pollId        String?
  poll          Poll?         @relation(fields: [pollId], references: [id], onDelete: Cascade)

  livestreamId  String?
  livestream    Livestream?   @relation(fields: [livestreamId], references: [id], onDelete: Cascade)

  parentId  String?   
  parent    Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentReplies")

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([userId])
  @@index([postId])
  @@index([podcastId])
  @@index([longvideoId])
  @@index([reelId])
  @@index([blogId])
  @@index([pollId])
  @@index([livestreamId])
}



model Share {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  postId        String?
  post          Post?         @relation(fields: [postId], references: [id], onDelete: Cascade)

  podcastId     String?
  podcast       Podcast?      @relation(fields: [podcastId], references: [id], onDelete: Cascade)

  longvideoId   String?
  longvideo     Longvideo?    @relation(fields: [longvideoId], references: [id], onDelete: Cascade)

  reelId        String?
  reel          Reel?         @relation(fields: [reelId], references: [id], onDelete: Cascade)

  blogId        String?
  blog          Blog?         @relation(fields: [blogId], references: [id], onDelete: Cascade)

  pollId        String?
  poll          Poll?         @relation(fields: [pollId], references: [id], onDelete: Cascade)

  livestreamId  String?
  livestream    Livestream?   @relation(fields: [livestreamId], references: [id], onDelete: Cascade)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([userId])
  @@index([postId])
  @@index([podcastId])
  @@index([longvideoId])
  @@index([reelId])
  @@index([blogId])
  @@index([pollId])
  @@index([livestreamId])
}



model Bookmark {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  postId        String?
  post          Post?         @relation(fields: [postId], references: [id], onDelete: Cascade)

  podcastId     String?
  podcast       Podcast?      @relation(fields: [podcastId], references: [id], onDelete: Cascade)

  longvideoId   String?
  longvideo     Longvideo?    @relation(fields: [longvideoId], references: [id], onDelete: Cascade)

  reelId        String?
  reel          Reel?         @relation(fields: [reelId], references: [id], onDelete: Cascade)

  blogId        String?
  blog          Blog?         @relation(fields: [blogId], references: [id], onDelete: Cascade)

  pollId        String?
  poll          Poll?         @relation(fields: [pollId], references: [id], onDelete: Cascade)

  livestreamId  String?
  livestream    Livestream?   @relation(fields: [livestreamId], references: [id], onDelete: Cascade)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([userId])
  @@index([postId])
  @@index([podcastId])
  @@index([longvideoId])
  @@index([reelId])
  @@index([blogId])
  @@index([pollId])
  @@index([livestreamId])
}
